
== SOPOS: 太陽位置

=== 目的

SOPOSは、緯度、経度、⽉、⽇、時刻をもとに太陽位置を求めるプログラムである。 + 
太陽位置を表すものとして、 sinh、sinA、cosA（h：太陽⾼度、A：太陽⽅位⾓）の3つを求める。


=== 入出力

.入力
[options="header" cols="1,4,2"]
|=================================
|変数名|説明|単位
|LA| 緯度（北緯はプラス、南緯はマイナス）|度 
|LO| 経度（東経はプラス、⻄経はマイナス）|度 
|M | ⽉| 
|N | ⽇|  
|HJ| 時刻（中央標準時） | 時
|=================================

.出力
[options="header" cols="1,4,2"]
|=================================
|変数名|説明|単位
|sinh| 太陽⾼度(h)の正弦 | 
|sinA| 太陽方位角(A)の正弦 | 
|cosA| 太陽方位角(A)の余弦 |
|TJ| 太陽時 | 時
|=================================

.定数
[options="header" cols="1,4,2"]
|=================================
|変数名|説明|値(単位)
|LOs| 中央標準時の基準となる⼟地の経度 | 135 度 
|RADI| 度からradに変換する係数 | 0.01745329 | 
|=================================

=== 使用する関数

* NUMDAY
* DEL
* EQT


=== 計算ロジック

時角 stem:[t] [rad]を次式で算出する。

====
通し日の算出
[stem]
++++++++++++++++++++++++++++++++++++++++++++
N_{day} = \rm{NUMDAY}(M, N)
++++++++++++++++++++++++++++++++++++++++++++
均時差の算出
[stem]
++++++++++++++++++++++++++++++++++++++++++++
e = \rm{EQT}(N_{day})
++++++++++++++++++++++++++++++++++++++++++++
時角[rad]の算出
[stem]
++++++++++++++++++++++++++++++++++++++++++++
t = (15 * (HJ - 12 + e) + LO + LOs) * \rm{RADI}
++++++++++++++++++++++++++++++++++++++++++++
====

日赤緯[rad]を算出する。
====
[stem]
++++++++++++++++++++++++++++++++++++++++++++
\delta = \rm{DEL}(N_{day}) * \rm{RADI}
++++++++++++++++++++++++++++++++++++++++++++
====

緯度をradに変換する。
====
[stem]
++++++++++++++++++++++++++++++++++++++++++++
\varphi = \rm{LA} * \rm{RADI}
++++++++++++++++++++++++++++++++++++++++++++
====


太陽高度をh、太陽方位角をAとすると、太陽位置を表すsinh、sinA、cosAは次式で算出される。

====
[stem]
++++++++++++++++++++++++++++++++++++++++++++
\sin h = \sin \varphi \cdot \sin \delta + \cos \varphi \cdot \cos \delta \cdot \cos t  \\
\cos h = \sqrt{1-(\sin h)^{2}}  \\
\sin A = \frac{\sin t \cdot \cos \delta}{cosh}  \\
\cos A = \frac{\sin h \cdot \sin \varphi - \sin \delta}{\cos h \cdot \cos \varphi}
++++++++++++++++++++++++++++++++++++++++++++
====

ただし、sinh<0 のときは、sinh=0、sinA=0、cosA=0 とする。

=== 注記

* 時刻 HJ は、⽇本標準時となっている。ELS=135.0 は明⽯の東経を⽰しているので、外国の時刻のときに は注意を要す。
* ⽇出、⽇没を求めるプログラムにはなっていない。
* ⽇⾚緯、均時差などは、ある⼀⽇では同⼀の値をとるので、時刻別に幾度もCALLするときなどは、DEL(W)、 EQT(W)の計算は無駄になっている。
* W の計算において、1 年を 366 ⽇とみなしているので、最⼤ 1 ⽇分の太陽位置の誤差が出る。

